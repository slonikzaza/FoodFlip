<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>FoodFlip</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f0f2f5;
      color: #333;
    }
    h2, h3 {
      color: #222;
    }
    .btn {
      padding: 12px 24px;
      margin: 8px 6px;
      border: none;
      border-radius: 12px;
      background: #4CAF50;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .btn:hover {
      background: #3e8e41;
    }
    .btn-secondary {
      background: #3498db;
    }
    .btn-secondary:hover {
      background: #2980b9;
    }
    .btn-danger {
      background: #e74c3c;
    }
    .btn-danger:hover {
      background: #c0392b;
    }
    .section {
      display: none;
      margin-top: 20px;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: white;
      padding: 20px;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .modal img {
      width: 160px;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .tab {
      display: none;
    }
    .tab.active {
      display: block;
    }
    .slot, .item {
      background: white;
      padding: 14px;
      margin: 10px 0;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .slot img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 15px;
    }
    .slot-info, .item-info {
      display: flex;
      align-items: center;
    }
    .slot-details, .item-details {
      line-height: 1.3;
    }
    .disabled {
      opacity: 0.5;
      text-decoration: line-through;
    }
    .navigation-buttons {
      margin-top: 20px;
      text-align: right;
    }
  </style>
</head>
<body>
  <h2>–í–∏–±–µ—Ä–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω:</h2>
  <button class="btn" onclick="selectRestaurant('mcdonalds')">McDonald's</button>
  <button class="btn" onclick="selectRestaurant('kfc')">KFC</button>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é -->
  <div id="menuSection" class="section">
    <h3>–ú–µ–Ω—é: <span id="restaurantName"></span></h3>

    <div class="filters">
      <label>–ú–∞–∫—Å. –∫–∞–ª–æ—Ä—ñ—ó:<input type="number" id="calorieFilter" value="1000"></label>
      <label>–ú–∞–∫—Å. —Ü—ñ–Ω–∞ (‚Ç¥): <input type="number" id="priceFilter" value="1000"></label>
      <button class="btn" onclick="filterAndPick()">üé≤ –†–∞–Ω–¥–æ–º</button>
    </div>

    <div id="dishList"></div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±–ª—é–¥–∞ (–¥–ª—è McDonald's) -->
  <div id="dishModalOverlay" class="modal-overlay">
    <div class="modal" id="dishModal">
      <img id="modalDishImg" src="" alt="Dish Image">
      <h3 id="modalDishName"></h3>
      <div class="navigation-buttons">
        <button class="btn-secondary" onclick="chooseOnlyDish()">–¢—ñ–ª—å–∫–∏ –±–ª—é–¥–æ</button>
        <button class="btn-secondary" onclick="chooseMenu()">–í–∏–±—Ä–∞—Ç–∏ –º–µ–Ω—é</button>
        <button class="btn-secondary" onclick="pickAnotherDish()">–Ü–Ω—à–µ (—Ä–∞–Ω–¥–æ–º–Ω–æ)</button>
      </div>
      <div style="margin-top:10px;">
        <button id="modalExcludeBtn" class="btn-danger" onclick="excludeCurrentDish()">–í–∏–∫–ª—é—á–∏—Ç–∏ –∑ —Ä–∞–Ω–¥–æ–º–∞</button>
      </div>
    </div>
  </div>

  <!-- –°–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω—é (–¥–ª—è McDonald's) -->
  <div id="menuBuilderSection" class="section">
    <h3>–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–µ–Ω—é McDonald's</h3>

    <!-- –í–∫–ª–∞–¥–∫–∏: –±–ª—é–¥–∞, —Å–æ—É—Å–∏, –Ω–∞–ø–æ—ó -->
    <div id="dishesTab" class="tab active">
      <h4>1. –û–±–µ—Ä—ñ—Ç—å —Ç—Ä–∏ —Å—Ç—Ä–∞–≤–∏:</h4>
      <div id="dishesSlots">
        <!-- –°–ª–æ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
      </div>
      <div class="navigation-buttons">
        <button id="toSaucesBtn" class="btn" onclick="toSauces()" disabled>–î–∞–ª—ñ: –°–æ—É—Å–∏</button>
      </div>
    </div>

    <div id="saucesTab" class="tab">
      <h4>2. –û–±–µ—Ä—ñ—Ç—å —Å–æ—É—Å:</h4>
      <div id="saucesList">
        <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —Å–æ—É—Å–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
      </div>
      <div class="navigation-buttons">
        <button class="btn" onclick="backToDishes()">–ù–∞–∑–∞–¥</button>
        <button id="toDrinksBtn" class="btn" onclick="toDrinks()" disabled>–î–∞–ª—ñ: –ù–∞–ø–æ—ó</button>
      </div>
    </div>

    <div id="drinksTab" class="tab">
      <h4>3. –û–±–µ—Ä—ñ—Ç—å –Ω–∞–ø—ñ–π:</h4>
      <div id="drinksList">
        <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–ø–∏—Ç–∫–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
      </div>
      <div class="navigation-buttons">
        <button class="btn" onclick="backToSauces()">–ù–∞–∑–∞–¥</button>
        <button id="finishMenuBtn" class="btn" onclick="finishMenu()" disabled>–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –º–µ–Ω—é</button>
      </div>
    </div>
  </div>

  <script>
    Telegram.WebApp.ready();

    // === –î–ê–ù–ù–´–ï ===
    const menus = {
      mcdonalds: [
        { name: "–ë—ñ–≥ –ú–∞–∫¬Æ", calories: 526, price: 141, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3413_BigMac.png" },
        { name: "–ë—ñ–≥ –¢–µ–π—Å—Ç—ñ –°–∏–Ω–≥–ª", calories: 620, price: 192, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3442_Sdwch_Big_Tasty_Single.jpg" },
        { name: "–¢–µ–π—Å—Ç—ñ –î–∂—É–Ω—ñ–æ—Ä", calories: 400, price: 104, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3441_Sdwch_Big_Tasty_Junior.jpg" },
        { name: "–î–∞–±–ª –ë—ñ–≥ –¢–µ–π—Å—Ç—ñ", calories: 880, price: 271, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3443_Sdwch_Big_Tasty_Double.jpg" },
        { name: "–î–∞–±–ª –†–æ—è–ª –ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 760, price: 240, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3415_DoubleRoyalCheeseburger_2.png" },
        { name: "–†–æ—è–ª –ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 530, price: 161, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3414_RoyalCheeseburger_2.png" },
        { name: "–ú–∞–∫–ß—ñ–∫–µ–Ω", calories: 448, price: 119, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3416_McChicken.png" },
        { name: "–§—ñ–ª–µ-–æ-–§—ñ—à", calories: 379, price: 117, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3412_File-o-Fish_2025.png" },
        { name: "–î–∞–±–ª –ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 475, price: 121, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3411_DoubleCheeseburger.png" },
        { name: "–ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 298, price: 73, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3409_Cheeseburger.png" },
        { name: "–ì–∞–º–±—É—Ä–≥–µ—Ä", calories: 249, price: 63, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3408_Hamburger.png" },
        { name: "–ß—ñ–∫–µ–Ω –ú–∞–∫–ù–∞–≥–µ—Ç—Å 6—à—Ç", calories: 265, price: 101, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_2130_Nuggets_6.png" },
        { name: "–ß—ñ–∫–µ–Ω –ú–∞–∫–ù–∞–≥–µ—Ç—Å 9—à—Ç", calories: 398, price: 145, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_2131_Nuggets_9.png" },
        { name: "–ß—ñ–∫–µ–Ω –î–∂—É–Ω—ñ–æ—Ä", calories: 330, price: 73, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3426_CHICKEN_JUNIOR_BEST.png" },
        { name: "–ö—É—Ä—è—á—ñ —Å—Ç—Ä—ñ–ø—Å–∏ 3—à—Ç", calories: 200, price: 97, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3500_3strips.png" }
      ],
      kfc: [
        { name: "Zinger Burger", calories: 610, price: 6, img: "https://i.imgur.com/DrlUPPs.png" },
        { name: "Twister", calories: 480, price: 5, img: "https://i.imgur.com/z04v2Y2.png" },
        { name: "Fries Box", calories: 320, price: 3, img: "https://i.imgur.com/DN9jHZr.png" }
      ]
    };

    const sauces = [
      { name: "–ö–µ—Ç—á—É–ø" },
      { name: "–ì–∞—Ä–±—É–∑–æ–≤–∏–π —Å–æ—É—Å" },
      { name: "–°–∏—Ä–Ω–∏–π —Å–æ—É—Å" },
      { name: "–ß–∞—Å–Ω–∏–∫–æ–≤–∏–π —Å–æ—É—Å" },
      { name: "–ß–∏–ª—ñ —Å–æ—É—Å" }
    ];

    const drinks = [
      { name: "Coca-Cola" },
      { name: "Fanta" },
      { name: "Sprite" },
      { name: "–í–æ–¥–∞" },
      { name: "–ß–∞–π —Ö–æ–ª–æ–¥–Ω–∏–π" }
    ];

    // === –°–û–°–¢–û–Ø–ù–ò–ï ===
    let selectedRestaurant = '';
    let excludedDishes = new Set();

    // –î–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    let currentPickedDish = null;

    // –î–ª—è –±–∏–ª–¥–µ—Ä–∞ –º–µ–Ω—é
    let menuSelection = {
      dishes: [null, null, null],  // —Ç—Ä–∏ –±–ª—é–¥–∞
      saucesExcl: new Set(),
      drinksExcl: new Set(),
      sauce: null,
      drink: null,
      dishesExcl: new Set()
    };

    // === –§–£–ù–ö–¶–ò–ò ===

    function selectRestaurant(restaurant) {
      selectedRestaurant = restaurant;
      document.getElementById("menuSection").style.display = "block";
      document.getElementById("menuBuilderSection").style.display = "none";
      document.getElementById("restaurantName").textContent =
        restaurant === "mcdonalds" ? "McDonald's" : "KFC";
      renderMenu();
    }

    function toggleDish(name) {
      if (excludedDishes.has(name)) {
        excludedDishes.delete(name);
      } else {
        excludedDishes.add(name);
      }
      renderMenu();
    }

    function renderMenu() {
      const container = document.getElementById("dishList");
      container.innerHTML = '';
      menus[selectedRestaurant].forEach(dish => {
        const div = document.createElement("div");
        div.className = "dish" + (excludedDishes.has(dish.name) ? " disabled" : "");
        div.innerHTML = `
          <div class="dish-info">
            <img src="${dish.img}" alt="${dish.name}">
            <div class="dish-details">
              <strong>${dish.name}</strong><br>
              ${dish.calories} –∫–∫–∞–ª ‚Äî ‚Ç¥${dish.price.toFixed(2)}
            </div>
          </div>
          <button class="btn btn-danger" onclick="toggleDish('${dish.name}')">
            ${excludedDishes.has(dish.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"}
          </button>
        `;
        container.appendChild(div);
      });
    }

    function filterAndPick() {
      const maxCalories = parseInt(document.getElementById("calorieFilter").value) || 9999;
      const maxPrice = parseFloat(document.getElementById("priceFilter").value) || 9999;

      const filtered = menus[selectedRestaurant].filter(d =>
        d.calories <= maxCalories &&
        d.price <= maxPrice &&
        !excludedDishes.has(d.name)
      );

      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö —Å—Ç—Ä–∞–≤ üòï");
        return;
      }

      const pick = filtered[Math.floor(Math.random() * filtered.length)];

      if (selectedRestaurant === 'kfc') {
        // –î–ª—è KFC —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –∞–ª–µ—Ä—Ç
        alert(`üéâ –¢–≤–æ—è —Å—Ç—Ä–∞–≤–∞: ${pick.name}`);
      } else {
        // –î–ª—è McDonald's ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –º–æ–¥–∞–ª
        showDishModal(pick);
      }
    }

    // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –±–ª—é–¥–∞ McDonald's ---
    function showDishModal(dish) {
      currentPickedDish = dish;
      document.getElementById("modalDishImg").src = dish.img;
      document.getElementById("modalDishName").textContent = dish.name;
      document.getElementById("modalExcludeBtn").textContent =
        excludedDishes.has(dish.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏ –∑ —Ä–∞–Ω–¥–æ–º–∞";
      document.getElementById("dishModalOverlay").style.display = "flex";
    }

    function closeDishModal() {
      document.getElementById("dishModalOverlay").style.display = "none";
      currentPickedDish = null;
    }

    function pickAnotherDish() {
      closeDishModal();
      filterAndPick();
    }

    function excludeCurrentDish() {
      if (!currentPickedDish) return;
      const name = currentPickedDish.name;
      if (excludedDishes.has(name)) {
        excludedDishes.delete(name);
      } else {
        excludedDishes.add(name);
      }
      closeDishModal();
      renderMenu();
    }

    function chooseOnlyDish() {
      if (!currentPickedDish) return;
      const name = currentPickedDish.name;
      closeDishModal();
      alert(`–í–∏ –æ–±—Ä–∞–ª–∏ –±–ª—é–¥–æ: ${name}`);
      // –ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    }

    function chooseMenu() {
      if (!currentPickedDish) return;
      closeDishModal();
      openMenuBuilder();
    }

    // --- –°—Ç—Ä–æ–∏—Ç–µ–ª—å –º–µ–Ω—é McDonald's ---
    function openMenuBuilder() {
      document.getElementById("menuSection").style.display = "none";
      document.getElementById("menuBuilderSection").style.display = "block";
      // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–∏–ª–¥–µ—Ä–∞
      menuSelection = {
        dishes: [null, null, null],
        dishesExcl: new Set(),
        saucesExcl: new Set(),
        drinksExcl: new Set(),
        sauce: null,
        drink: null
      };
      renderDishesSlots();
      renderSaucesList();
      renderDrinksList();
      updateDishesNextButton();
      updateSaucesNextButton();
      updateFinishButton();
    }

    // --- –í–∫–ª–∞–¥–∫–∞ "–ë–ª—é–¥–∞" ---
    function renderDishesSlots() {
      const container = document.getElementById("dishesSlots");
      container.innerHTML = '';
      for (let i = 0; i < 3; i++) {
        const slot = document.createElement("div");
        slot.className = "slot" + (menuSelection.dishes[i] && menuSelection.dishesExcl.has(menuSelection.dishes[i].name) ? " disabled" : "");
        let content = '';
        if (menuSelection.dishes[i]) {
          const d = menuSelection.dishes[i];
          content = `
            <div class="slot-info">
              <img src="${d.img}" alt="${d.name}">
              <div class="slot-details">
                <strong>${d.name}</strong><br>
                ${d.calories} –∫–∫–∞–ª ‚Äî ‚Ç¥${d.price.toFixed(2)}
              </div>
            </div>
            <div>
              <button class="btn-secondary" onclick="randomizeDishSlot(${i})">üé≤</button>
              <button class="btn-danger" onclick="excludeDishFromSlot(${i})">${
                menuSelection.dishesExcl.has(d.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"
              }</button>
            </div>
          `;
        } else {
          content = `
            <div class="slot-info" style="opacity: 0.5;">
              <img src="https://via.placeholder.com/60?text=?" alt="Placeholder">
              <div class="slot-details">
                <strong>–ü—É—Å—Ç–æ</strong><br>
                –ù–µ–º–∞—î –æ–±—Ä–∞–Ω–æ–≥–æ
              </div>
            </div>
            <div>
              <button class="btn-secondary" onclick="randomizeDishSlot(${i})">üé≤ –†–∞–Ω–¥–æ–º –¥–ª—è —Å–ª–æ—Ç—É ${i+1}</button>
            </div>
          `;
        }
        slot.innerHTML = content;
        container.appendChild(slot);
      }
    }

    function randomizeDishSlot(index) {
      const maxCalories = parseInt(document.getElementById("calorieFilter").value) || 9999;
      const maxPrice = parseFloat(document.getElementById("priceFilter").value) || 9999;

      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –∏—Å–∫–ª—é—á–∞–µ–º –≤—Å–µ, —á—Ç–æ –≤ excludedDishes, –∞ —Ç–∞–∫–∂–µ —Ç–µ, —á—Ç–æ —É–∂–µ –≤—ã–±—Ä–∞–Ω—ã –≤ –¥—Ä—É–≥–∏—Ö —Å–ª–æ—Ç–∞—Ö, –∏ —Ç–µ, —á—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–º–µ–Ω–Ω–æ –¥–ª—è –º–µ–Ω—é
      const filtered = menus.mcdonalds.filter(d =>
        d.calories <= maxCalories &&
        d.price <= maxPrice &&
        !excludedDishes.has(d.name) &&
        !menuSelection.dishesExcl.has(d.name) &&
        menuSelection.dishes.every((sel, idx) => idx === index || (sel && sel.name !== d.name))
      );

      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å—Ç—Ä–∞–≤ –¥–ª—è —Ü—å–æ–≥–æ —Å–ª–æ—Ç—É üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      menuSelection.dishes[index] = pick;
      renderDishesSlots();
      updateDishesNextButton();
    }

    function excludeDishFromSlot(index) {
      const picked = menuSelection.dishes[index];
      if (!picked) return;
      const name = picked.name;
      if (menuSelection.dishesExcl.has(name)) {
        menuSelection.dishesExcl.delete(name);
      } else {
        menuSelection.dishesExcl.add(name);
      }
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ª–æ—Ç
      menuSelection.dishes[index] = null;
      renderDishesSlots();
      updateDishesNextButton();
    }

    function updateDishesNextButton() {
      const allPicked = menuSelection.dishes.every(d => d !== null && !menuSelection.dishesExcl.has(d.name));
      document.getElementById("toSaucesBtn").disabled = !allPicked;
    }

    function toSauces() {
      switchTab('dishesTab', 'saucesTab');
    }

    // --- –í–∫–ª–∞–¥–∫–∞ "–°–æ—É—Å–∏" ---
    function renderSaucesList() {
      const container = document.getElementById("saucesList");
      container.innerHTML = '';
      sauces.forEach(s => {
        const div = document.createElement("div");
        div.className = "item" + (menuSelection.saucesExcl.has(s.name) ? " disabled" : "");
        div.innerHTML = `
          <div class="item-info">
            <div class="item-details">
              <strong>${s.name}</strong>
            </div>
          </div>
          <div>
            <button class="btn-secondary" onclick="randomizeSauce('${s.name}')">üé≤</button>
            <button class="btn-danger" onclick="toggleSauceExclusion('${s.name}')">
              ${menuSelection.saucesExcl.has(s.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"}
            </button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function randomizeSauce() {
      const filtered = sauces.filter(s =>
        !menuSelection.saucesExcl.has(s.name)
      );
      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å–æ—É—Å—ñ–≤ üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      menuSelection.sauce = pick;
      renderSaucesList();
      highlightSelectedSauce();
      updateSaucesNextButton();
    }

    function toggleSauceExclusion(name) {
      if (menuSelection.saucesExcl.has(name)) {
        menuSelection.saucesExcl.delete(name);
      } else {
        menuSelection.saucesExcl.add(name);
      }
      // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—É—Å —Ç–µ–ø–µ—Ä—å –∏—Å–∫–ª—é—á–µ–Ω, —Å–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä
      if (menuSelection.sauce && menuSelection.sauce.name === name) {
        menuSelection.sauce = null;
      }
      renderSaucesList();
      updateSaucesNextButton();
    }

    function highlightSelectedSauce() {
      if (!menuSelection.sauce) return;
      // –î–æ–±–∞–≤–∏–º –Ω–µ–±–æ–ª—å—à—É—é –æ—Ç–º–µ—Ç–∫—É –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–æ—É—Å—É
      const items = document.querySelectorAll('#saucesList .item');
      items.forEach(div => {
        if (div.querySelector('.item-details').textContent.trim() === menuSelection.sauce.name) {
          div.style.background = "#d4f0d4";
        } else {
          div.style.background = "white";
        }
      });
    }

    function updateSaucesNextButton() {
      document.getElementById("toDrinksBtn").disabled = menuSelection.sauce === null;
    }

    function backToDishes() {
      switchTab('saucesTab', 'dishesTab');
    }

    function toDrinks() {
      switchTab('saucesTab', 'drinksTab');
    }

    // --- –í–∫–ª–∞–¥–∫–∞ "–ù–∞–ø–æ—ó" ---
    function renderDrinksList() {
      const container = document.getElementById("drinksList");
      container.innerHTML = '';
      drinks.forEach(d => {
        const div = document.createElement("div");
        div.className = "item" + (menuSelection.drinksExcl.has(d.name) ? " disabled" : "");
        div.innerHTML = `
          <div class="item-info">
            <div class="item-details">
              <strong>${d.name}</strong>
            </div>
          </div>
          <div>
            <button class="btn-secondary" onclick="randomizeDrink('${d.name}')">üé≤</button>
            <button class="btn-danger" onclick="toggleDrinkExclusion('${d.name}')">
              ${menuSelection.drinksExcl.has(d.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"}
            </button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function randomizeDrink() {
      const filtered = drinks.filter(d =>
        !menuSelection.drinksExcl.has(d.name)
      );
      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –Ω–∞–ø–æ—ó–≤ üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      menuSelection.drink = pick;
      renderDrinksList();
      highlightSelectedDrink();
      updateFinishButton();
    }

    function toggleDrinkExclusion(name) {
      if (menuSelection.drinksExcl.has(name)) {
        menuSelection.drinksExcl.delete(name);
      } else {
        menuSelection.drinksExcl.add(name);
      }
      if (menuSelection.drink && menuSelection.drink.name === name) {
        menuSelection.drink = null;
      }
      renderDrinksList();
      updateFinishButton();
    }

    function highlightSelectedDrink() {
      if (!menuSelection.drink) return;
      const items = document.querySelectorAll('#drinksList .item');
      items.forEach(div => {
        if (div.querySelector('.item-details').textContent.trim() === menuSelection.drink.name) {
          div.style.background = "#d4f0d4";
        } else {
          div.style.background = "white";
        }
      });
    }

    function backToSauces() {
      switchTab('drinksTab', 'saucesTab');
    }

    function updateFinishButton() {
      document.getElementById("finishMenuBtn").disabled = menuSelection.drink === null;
    }

    function finishMenu() {
      const dishesNames = menuSelection.dishes.map(d => d.name).join(", ");
      const sauceName = menuSelection.sauce.name;
      const drinkName = menuSelection.drink.name;
      alert(`–í–∞—à–µ –º–µ–Ω—é:\n\n–°—Ç—Ä–∞–≤–∏: ${dishesNames}\n–°–æ—É—Å: ${sauceName}\n–ù–∞–ø—ñ–π: ${drinkName}`);
      // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É
      document.getElementById("menuBuilderSection").style.display = "none";
      document.getElementById("menuSection").style.display = "block";
      renderMenu();
    }

    // --- –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ ---
    function switchTab(hideId, showId) {
      document.getElementById(hideId).classList.remove('active');
      document.getElementById(showId).classList.add('active');
    }
  </script>
</body>
</html>
