<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>FoodFlip</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f0f2f5;
      color: #333;
    }
    h2, h3, h4 {
      color: #222;
      margin-top: 0;
    }
    .btn {
      padding: 12px 24px;
      margin: 8px 6px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #6DD5FA, #2980B9);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.3s ease, transform 0.2s ease;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
    }
    .btn-secondary {
      background: linear-gradient(135deg, #F2994A, #F2C94C);
    }
    .btn-danger {
      background: linear-gradient(135deg, #EB5757, #BB2D3B);
    }
    .section {
      display: none;
      margin-top: 20px;
    }
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .modal img {
      width: 160px;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .tab {
      display: none;
    }
    .tab.active {
      display: block;
    }
    .item {
      background: #fff;
      padding: 14px;
      margin: 10px 0;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 15px;
    }
    .item-info {
      display: flex;
      align-items: center;
    }
    .item-details {
      line-height: 1.3;
    }
    .disabled {
      opacity: 0.5;
      text-decoration: line-through;
    }
    .navigation-buttons {
      margin-top: 20px;
      text-align: right;
    }
  </style>
</head>
<body>
  <h2>–í–∏–±–µ—Ä–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω:</h2>
  <button class="btn" onclick="selectRestaurant('mcdonalds')">McDonald's</button>
  <button class="btn" onclick="selectRestaurant('kfc')">KFC</button>

  <!-- –û—Å–Ω–æ–≤–Ω–µ –º–µ–Ω—é -->
  <div id="menuSection" class="section">
    <h3>–ú–µ–Ω—é: <span id="restaurantName"></span></h3>
    <div class="filters">
      <label>–ú–∞–∫—Å. –∫–∞–ª–æ—Ä—ñ—ó:<input type="number" id="calorieFilter" value="1000"></label>
      <label>–ú–∞–∫—Å. —Ü—ñ–Ω–∞ (‚Ç¥): <input type="number" id="priceFilter" value="1000"></label>
      <button class="btn" onclick="filterAndPick()">üé≤ –†–∞–Ω–¥–æ–º</button>
    </div>
    <div id="dishList"></div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ—ó —Å—Ç—Ä–∞–≤–∏ (McDonald's) -->
  <div id="dishModalOverlay" class="modal-overlay">
    <div class="modal" id="dishModal">
      <img id="modalDishImg" src="" alt="Dish Image">
      <h3 id="modalDishName"></h3>
      <div class="navigation-buttons">
        <button class="btn-secondary" onclick="chooseOnlyDish()">–¢—ñ–ª—å–∫–∏ –±–ª—é–¥–æ</button>
        <button class="btn-secondary" onclick="chooseMenu()">–í–∏–±—Ä–∞—Ç–∏ –º–µ–Ω—é</button>
        <button class="btn-secondary" onclick="pickAnotherDish()">–Ü–Ω—à–µ (—Ä–∞–Ω–¥–æ–º–Ω–æ)</button>
      </div>
      <div style="margin-top:10px;">
        <button id="modalExcludeBtn" class="btn-danger" onclick="excludeCurrentDish()">–í–∏–∫–ª—é—á–∏—Ç–∏ –∑ —Ä–∞–Ω–¥–æ–º–∞</button>
      </div>
    </div>
  </div>

  <!-- –°–µ–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–µ–Ω—é McDonald's -->
  <div id="menuBuilderSection" class="section">
    <h3>–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–µ–Ω—é McDonald's</h3>

    <!-- –í–∫–ª–∞–¥–∫–∏: 1. –ë–ª—é–¥–æ, 2. –°–æ—É—Å–∏, 3. –ù–∞–ø–æ—ó -->
    <div id="dishesTab" class="tab active">
      <h4>1. –û–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É —Å—Ç—Ä–∞–≤—É:</h4>
      <div id="firstChoices">
        <!-- –¢—Ä–∏ –≤–∞—Ä—ñ–∞–Ω—Ç–∏: –ö–∞—Ä—Ç–æ–ø–ª—è —Ñ—Ä—ñ, –î—ñ–ø–∏, –°–∞–ª–∞—Ç -->
        <!-- –ë—É–¥–µ–º–æ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ JS-–æ–º -->
      </div>
      <div class="navigation-buttons">
        <button id="toSaucesBtn" class="btn" onclick="toSauces()" disabled>–î–∞–ª—ñ: –°–æ—É—Å–∏</button>
      </div>
    </div>

    <div id="saucesTab" class="tab">
      <h4>2. –û–±–µ—Ä—ñ—Ç—å —Å–æ—É—Å:</h4>
      <div id="saucesList"></div>
      <div class="navigation-buttons">
        <button class="btn" onclick="backToDishes()">–ù–∞–∑–∞–¥</button>
        <button id="toDrinksBtn" class="btn" onclick="toDrinks()" disabled>–î–∞–ª—ñ: –ù–∞–ø–æ—ó</button>
      </div>
    </div>

    <div id="drinksTab" class="tab">
      <h4>3. –û–±–µ—Ä—ñ—Ç—å –Ω–∞–ø—ñ–π:</h4>
      <div id="drinksList"></div>
      <div class="navigation-buttons">
        <button class="btn" onclick="backToSauces()">–ù–∞–∑–∞–¥</button>
        <button id="finishMenuBtn" class="btn" onclick="finishMenu()" disabled>–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –º–µ–Ω—é</button>
      </div>
    </div>
  </div>

  <script>
    Telegram.WebApp.ready();

    // === –î–ê–ù–Ü ===
    const menus = {
      mcdonalds: [
        { name: "–ë—ñ–≥ –ú–∞–∫¬Æ", calories: 526, price: 141, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3413_BigMac.png" },
        { name: "–ë—ñ–≥ –¢–µ–π—Å—Ç—ñ –°–∏–Ω–≥–ª", calories: 620, price: 192, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3442_Sdwch_Big_Tasty_Single.jpg" },
        { name: "–¢–µ–π—Å—Ç—ñ –î–∂—É–Ω—ñ–æ—Ä", calories: 400, price: 104, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3441_Sdwch_Big_Tasty_Junior.jpg" },
        // ... —ñ–Ω—à—ñ —Å—Ç—Ä–∞–≤–∏
      ],
      kfc: [
        { name: "Zinger Burger", calories: 610, price: 6, img: "https://i.imgur.com/DrlUPPs.png" },
        { name: "Twister", calories: 480, price: 5, img: "https://i.imgur.com/z04v2Y2.png" },
        { name: "Fries Box", calories: 320, price: 3, img: "https://i.imgur.com/DN9jHZr.png" }
      ]
    };

    const sauces = [
      { name: "–ö–µ—Ç—á—É–ø" },
      { name: "–ì–∞—Ä–±—É–∑–æ–≤–∏–π —Å–æ—É—Å" },
      { name: "–°–∏—Ä–Ω–∏–π —Å–æ—É—Å" },
      { name: "–ß–∞—Å–Ω–∏–∫–æ–≤–∏–π —Å–æ—É—Å" },
      { name: "–ß–∏–ª—ñ —Å–æ—É—Å" }
    ];

    const drinks = [
      { name: "Coca-Cola" },
      { name: "Fanta" },
      { name: "Sprite" },
      { name: "–í–æ–¥–∞" },
      { name: "–ß–∞–π —Ö–æ–ª–æ–¥–Ω–∏–π" }
    ];

    // –ü–µ—Ä–µ–ª—ñ–∫ —ñ–∑ —Ç—Ä—å–æ—Ö –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π –¥–ª—è –ø–µ—Ä—à–æ—ó –≤–∫–ª–∞–¥–∫–∏
    const firstChoices = [
      { name: "–ö–∞—Ä—Ç–æ–ø–ª—è —Ñ—Ä—ñ", img: "https://i.imgur.com/3pZe5kq.png" },
      { name: "–î—ñ–ø–∏",       img: "https://i.imgur.com/Cl8vQTo.png" },
      { name: "–°–∞–ª–∞—Ç",      img: "https://i.imgur.com/ODQ6oTs.png" }
    ];

    // === –°–¢–ê–ù ===
    let selectedRestaurant = '';
    let excludedDishes = new Set();
    let currentPickedDish = null; // –¥–ª—è –º–æ–¥–∞–ª–∫–∏
    let builderSelection = {
      firstDish: null,    // –≤–∏–±—Ä–∞–Ω–∞ –æ–¥–Ω–∞ —Å—Ç—Ä–∞–≤–∞ —ñ–∑ —Ç—Ä—å–æ—Ö
      sauce: null,
      drink: null,
      saucesExcl: new Set(),
      drinksExcl: new Set()
    };

    // === –§–£–ù–ö–¶–Ü–á ===
    function selectRestaurant(restaurant) {
      selectedRestaurant = restaurant;
      document.getElementById("menuSection").style.display = "block";
      document.getElementById("menuBuilderSection").style.display = "none";
      document.getElementById("restaurantName").textContent =
        restaurant === "mcdonalds" ? "McDonald's" : "KFC";
      renderMenu();
    }

    function renderMenu() {
      const container = document.getElementById("dishList");
      container.innerHTML = '';
      menus[selectedRestaurant].forEach(dish => {
        const div = document.createElement("div");
        div.className = "item" + (excludedDishes.has(dish.name) ? " disabled" : "");
        div.innerHTML = `
          <div class="item-info">
            <img src="${dish.img}" alt="${dish.name}">
            <div class="item-details">
              <strong>${dish.name}</strong><br>
              ${dish.calories} –∫–∫–∞–ª ‚Äî ‚Ç¥${dish.price.toFixed(2)}
            </div>
          </div>
          <button class="btn-danger" onclick="toggleDish('${dish.name}')">
            ${excludedDishes.has(dish.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"}
          </button>
        `;
        container.appendChild(div);
      });
    }

    function toggleDish(name) {
      if (excludedDishes.has(name)) {
        excludedDishes.delete(name);
      } else {
        excludedDishes.add(name);
      }
      renderMenu();
    }

    function filterAndPick() {
      const maxCalories = parseInt(document.getElementById("calorieFilter").value) || 9999;
      const maxPrice = parseFloat(document.getElementById("priceFilter").value) || 9999;
      const filtered = menus[selectedRestaurant].filter(d =>
        d.calories <= maxCalories &&
        d.price <= maxPrice &&
        !excludedDishes.has(d.name)
      );
      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö —Å—Ç—Ä–∞–≤ üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      if (selectedRestaurant === 'kfc') {
        alert(`üéâ –¢–≤–æ—è —Å—Ç—Ä–∞–≤–∞: ${pick.name}`);
      } else {
        showDishModal(pick);
      }
    }

    // --- –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –î–õ–Ø –í–ò–ë–†–ê–ù–û–á –°–¢–†–ê–í–ò ---
    function showDishModal(dish) {
      currentPickedDish = dish;
      document.getElementById("modalDishImg").src = dish.img;
      document.getElementById("modalDishName").textContent = dish.name;
      document.getElementById("modalExcludeBtn").textContent =
        excludedDishes.has(dish.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏ –∑ —Ä–∞–Ω–¥–æ–º–∞";
      document.getElementById("dishModalOverlay").style.display = "flex";
    }

    function closeDishModal() {
      document.getElementById("dishModalOverlay").style.display = "none";
      currentPickedDish = null;
    }

    function pickAnotherDish() {
      closeDishModal();
      filterAndPick();
    }

    function excludeCurrentDish() {
      if (!currentPickedDish) return;
      const name = currentPickedDish.name;
      if (excludedDishes.has(name)) {
        excludedDishes.delete(name);
      } else {
        excludedDishes.add(name);
      }
      closeDishModal();
      renderMenu();
    }

    function chooseOnlyDish() {
      if (!currentPickedDish) return;
      const name = currentPickedDish.name;
      closeDishModal();
      alert(`–í–∏ –æ–±—Ä–∞–ª–∏ –±–ª—é–¥–æ: ${name}`);
    }

    function chooseMenu() {
      if (!currentPickedDish) return;
      closeDishModal();
      openMenuBuilder();
    }

    // --- –í–Ü–î–ö–†–ò–¢–ò –ë–Ü–õ–î–ï–† –ú–ï–ù–Æ ---
    function openMenuBuilder() {
      selectedRestaurant = 'mcdonalds';
      document.getElementById("menuSection").style.display = "none";
      document.getElementById("menuBuilderSection").style.display = "block";
      // –°–∫–∏–¥–∞—î–º–æ –≤–∏–±–æ—Ä–∏
      builderSelection = {
        firstDish: null,
        sauce: null,
        drink: null,
        saucesExcl: new Set(),
        drinksExcl: new Set()
      };
      renderFirstChoices();
      renderSaucesList();
      renderDrinksList();
      updateToSaucesButton();
      updateToDrinksButton();
      updateFinishButton();
      switchTab('saucesTab', 'dishesTab');
    }

    // --- –í–ö–õ–ê–î–ö–ê 1: –í–ò–ë–Ü–† –Ü–ó –¢–†–¨–û–• –°–¢–†–ê–í ---
    function renderFirstChoices() {
      const container = document.getElementById("firstChoices");
      container.innerHTML = '';
      firstChoices.forEach(choice => {
        const div = document.createElement("div");
        div.className = "item" + (builderSelection.firstDish && builderSelection.firstDish.name === choice.name ? " active" : "");
        div.innerHTML = `
          <div class="item-info">
            <img src="${choice.img}" alt="${choice.name}">
            <div class="item-details">
              <strong>${choice.name}</strong>
            </div>
          </div>
          <button class="btn-secondary" onclick="pickFirstDish('${choice.name}')">üé≤</button>
        `;
        container.appendChild(div);
      });
    }

    function pickFirstDish(name) {
      builderSelection.firstDish = firstChoices.find(c => c.name === name);
      renderFirstChoices();
      updateToSaucesButton();
    }

    function updateToSaucesButton() {
      document.getElementById("toSaucesBtn").disabled = !builderSelection.firstDish;
    }

    function toSauces() {
      if (!builderSelection.firstDish) return;
      switchTab('dishesTab', 'saucesTab');
    }

    // --- –í–ö–õ–ê–î–ö–ê 2: –°–û–£–°–ò ---
    function renderSaucesList() {
      const container = document.getElementById("saucesList");
      container.innerHTML = '';
      sauces.forEach(s => {
        const div = document.createElement("div");
        div.className = "item" + (builderSelection.saucesExcl.has(s.name) ? " disabled" : "");
        div.innerHTML = `
          <div class="item-info">
            <div class="item-details">
              <strong>${s.name}</strong>
            </div>
          </div>
          <div>
            <button class="btn-secondary" onclick="pickSauce('${s.name}')">üé≤</button>
            <button class="btn-danger" onclick="toggleSauceExclusion('${s.name}')">
              ${builderSelection.saucesExcl.has(s.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"}
            </button>
          </div>
        `;
        container.appendChild(div);
      });
      highlightSelectedSauce();
    }

    function pickSauce(name) {
      if (builderSelection.saucesExcl.has(name)) return;
      builderSelection.sauce = sauces.find(s => s.name === name);
      renderSaucesList();
      updateToDrinksButton();
    }

    function toggleSauceExclusion(name) {
      if (builderSelection.saucesExcl.has(name)) {
        builderSelection.saucesExcl.delete(name);
        if (builderSelection.sauce && builderSelection.sauce.name === name) {
          builderSelection.sauce = null;
        }
      } else {
        builderSelection.saucesExcl.add(name);
        if (builderSelection.sauce && builderSelection.sauce.name === name) {
          builderSelection.sauce = null;
        }
      }
      renderSaucesList();
      updateToDrinksButton();
    }

    function highlightSelectedSauce() {
      if (!builderSelection.sauce) return;
      const items = document.querySelectorAll('#saucesList .item');
      items.forEach(div => {
        const title = div.querySelector('.item-details').textContent.trim();
        if (title === builderSelection.sauce.name) {
          div.style.background = "#d4f0d4";
        } else {
          div.style.background = "white";
        }
      });
    }

    function updateToDrinksButton() {
      document.getElementById("toDrinksBtn").disabled = !builderSelection.sauce;
    }

    function backToDishes() {
      switchTab('saucesTab', 'dishesTab');
    }

    function toDrinks() {
      if (!builderSelection.sauce) return;
      switchTab('saucesTab', 'drinksTab');
    }

    // --- –í–ö–õ–ê–î–ö–ê 3: –ù–ê–ü–û–á ---
    function renderDrinksList() {
      const container = document.getElementById("drinksList");
      container.innerHTML = '';
      drinks.forEach(d => {
        const div = document.createElement("div");
        div.className = "item" + (builderSelection.drinksExcl.has(d.name) ? " disabled" : "");
        div.innerHTML = `
          <div class="item-info">
            <div class="item-details">
              <strong>${d.name}</strong>
            </div>
          </div>
          <div>
            <button class="btn-secondary" onclick="pickDrink('${d.name}')">üé≤</button>
            <button class="btn-danger" onclick="toggleDrinkExclusion('${d.name}')">
              ${builderSelection.drinksExcl.has(d.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"}
            </button>
          </div>
        `;
        container.appendChild(div);
      });
      highlightSelectedDrink();
    }

    function pickDrink(name) {
      if (builderSelection.drinksExcl.has(name)) return;
      builderSelection.drink = drinks.find(d => d.name === name);
      renderDrinksList();
      updateFinishButton();
    }

    function toggleDrinkExclusion(name) {
      if (builderSelection.drinksExcl.has(name)) {
        builderSelection.drinksExcl.delete(name);
        if (builderSelection.drink && builderSelection.drink.name === name) {
          builderSelection.drink = null;
        }
      } else {
        builderSelection.drinksExcl.add(name);
        if (builderSelection.drink && builderSelection.drink.name === name) {
          builderSelection.drink = null;
        }
      }
      renderDrinksList();
      updateFinishButton();
    }

    function highlightSelectedDrink() {
      if (!builderSelection.drink) return;
      const items = document.querySelectorAll('#drinksList .item');
      items.forEach(div => {
        const title = div.querySelector('.item-details').textContent.trim();
        if (title === builderSelection.drink.name) {
          div.style.background = "#d4f0d4";
        } else {
          div.style.background = "white";
        }
      });
    }

    function backToSauces() {
      switchTab('drinksTab', 'saucesTab');
    }

    function updateFinishButton() {
      document.getElementById("finishMenuBtn").disabled = !builderSelection.drink;
    }

    function finishMenu() {
      const firstDish = builderSelection.firstDish.name;
      const sauceName = builderSelection.sauce.name;
      const drinkName = builderSelection.drink.name;
      alert(`–í–∞—à–µ –º–µ–Ω—é:\n\n–°—Ç—Ä–∞–≤–∞: ${firstDish}\n–°–æ—É—Å: ${sauceName}\n–ù–∞–ø—ñ–π: ${drinkName}`);
      document.getElementById("menuBuilderSection").style.display = "none";
      document.getElementById("menuSection").style.display = "block";
      renderMenu();
    }

    // --- –£–ù–Ü–í–ï–†–°–ê–õ–¨–ù–ê –§–£–ù–ö–¶–Ü–Ø –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ù–Ø –í–ö–õ–ê–î–û–ö ---
    function switchTab(hideId, showId) {
      document.getElementById(hideId).classList.remove('active');
      document.getElementById(showId).classList.add('active');
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –ø–µ—Ä—à—É –≤–∫–ª–∞–¥–∫—É –∑ —Ç—Ä—å–æ–º–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏
    function initFirstChoices() {
      renderFirstChoices();
    }
    initFirstChoices();
  </script>
</body>
</html>
