<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>FoodFlip</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f0f2f5;
      color: #333;
    }
    h2, h3, h4 {
      color: #222;
      margin-top: 0;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 0;
      margin: 8px 6px;
      width: 140px;
      height: 48px;
      border: none;
      border-radius: 24px;
      background: linear-gradient(135deg, #6DD5FA, #2980B9);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.3s ease, transform 0.2s ease;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
    }
    .btn-secondary {
      background: linear-gradient(135deg, #F2994A, #F2C94C);
    }
    .btn-danger {
      background: linear-gradient(135deg, #EB5757, #BB2D3B);
    }
    .section {
      display: none;
      margin-top: 20px;
    }
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .modal img {
      width: 160px;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .tab {
      display: none;
    }
    .tab.active {
      display: block;
    }
    .item {
      background: #fff;
      padding: 14px;
      margin: 10px 0;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 15px;
    }
    .item-info {
      display: flex;
      align-items: center;
    }
    .item-details {
      line-height: 1.3;
    }
    .disabled {
      opacity: 0.5;
      text-decoration: line-through;
    }
    .navigation-buttons {
      margin-top: 20px;
      text-align: right;
    }
  </style>
</head>
<body>
  <h2>–í–∏–±–µ—Ä–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω:</h2>
  <button class="btn" onclick="selectRestaurant('mcdonalds')">McDonald's</button>
  <button class="btn" onclick="selectRestaurant('kfc')">KFC</button>

  <!-- –û—Å–Ω–æ–≤–Ω–µ –º–µ–Ω—é -->
  <div id="menuSection" class="section">
    <h3>–ú–µ–Ω—é: <span id="restaurantName"></span></h3>
    <div class="filters">
      <label>–ú–∞–∫—Å. –∫–∞–ª–æ—Ä—ñ—ó:<input type="number" id="calorieFilter" value="1000"></label>
      <label>–ú–∞–∫—Å. —Ü—ñ–Ω–∞ (‚Ç¥): <input type="number" id="priceFilter" value="1000"></label>
      <button class="btn" onclick="filterAndPick()">üé≤ –†–∞–Ω–¥–æ–º</button>
    </div>
    <div id="dishList"></div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ—ó —Å—Ç—Ä–∞–≤–∏ (McDonald's) -->
  <div id="dishModalOverlay" class="modal-overlay">
    <div class="modal" id="dishModal">
      <img id="modalDishImg" src="" alt="Dish Image">
      <h3 id="modalDishName"></h3>
      <div class="navigation-buttons">
        <button class="btn-secondary" onclick="chooseOnlyDish()">–¢—ñ–ª—å–∫–∏ –±–ª—é–¥–æ</button>
        <button class="btn-secondary" onclick="chooseMenu()">–í–∏–±—Ä–∞—Ç–∏ –º–µ–Ω—é</button>
        <button class="btn-secondary" onclick="pickAnotherDish()">–Ü–Ω—à–µ (—Ä–∞–Ω–¥–æ–º–Ω–æ)</button>
      </div>
      <div style="margin-top:10px;">
        <button id="modalExcludeBtn" class="btn-danger" onclick="excludeCurrentDish()">–í–∏–∫–ª—é—á–∏—Ç–∏ –∑ —Ä–∞–Ω–¥–æ–º–∞</button>
      </div>
    </div>
  </div>

  <!-- –°–µ–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–µ–Ω—é McDonald's -->
  <div id="menuBuilderSection" class="section">
    <h3>–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–µ–Ω—é McDonald's</h3>

    <!-- –í–∫–ª–∞–¥–∫–∏: 1. –ë–ª—é–¥–æ, 2. –°–æ—É—Å–∏, 3. –ù–∞–ø–æ—ó -->
    <div id="dishesTab" class="tab active">
      <h4>1. –û–±–µ—Ä—ñ—Ç—å —Å—Ç—Ä–∞–≤—É:</h4>
      <div id="selectedDish" class="item" style="justify-content: center; font-style: italic;">
        –ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ–≥–æ –±–ª—é–¥–∞
      </div>
      <div class="navigation-buttons">
        <button id="randomDishBtn" class="btn" onclick="randomizeBuilderDish()">üé≤ –†–∞–Ω–¥–æ–º –±–ª—é–¥–æ</button>
        <button id="toSaucesBtn" class="btn" onclick="toSauces()" disabled>–î–∞–ª—ñ: –°–æ—É—Å–∏</button>
      </div>
    </div>

    <div id="saucesTab" class="tab">
      <h4>2. –û–±–µ—Ä—ñ—Ç—å —Å–æ—É—Å:</h4>
      <div id="selectedSauce" class="item" style="justify-content: center; font-style: italic;">
        –ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Å–æ—É—Å—É
      </div>
      <div class="navigation-buttons">
        <button class="btn" onclick="backToDishes()">–ù–∞–∑–∞–¥</button>
        <button id="randomSauceBtn" class="btn-secondary" onclick="randomizeBuilderSauce()">üé≤ –†–∞–Ω–¥–æ–º —Å–æ—É—Å</button>
        <button id="toDrinksBtn" class="btn" onclick="toDrinks()" disabled>–î–∞–ª—ñ: –ù–∞–ø–æ—ó</button>
      </div>
    </div>

    <div id="drinksTab" class="tab">
      <h4>3. –û–±–µ—Ä—ñ—Ç—å –Ω–∞–ø—ñ–π:</h4>
      <div id="selectedDrink" class="item" style="justify-content: center; font-style: italic;">
        –ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ–≥–æ –Ω–∞–ø–æ—é
      </div>
      <div class="navigation-buttons">
        <button class="btn" onclick="backToSauces()">–ù–∞–∑–∞–¥</button>
        <button id="randomDrinkBtn" class="btn-secondary" onclick="randomizeBuilderDrink()">üé≤ –†–∞–Ω–¥–æ–º –Ω–∞–ø—ñ–π</button>
        <button id="finishMenuBtn" class="btn" onclick="finishMenu()" disabled>–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –º–µ–Ω—é</button>
      </div>
    </div>
  </div>

  <script>
    Telegram.WebApp.ready();

    // === –î–ê–ù–Ü ===
    const menus = {
      mcdonalds: [
        { name: "–ë—ñ–≥ –ú–∞–∫¬Æ", calories: 526, price: 141, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3413_BigMac.png" },
        { name: "–ë—ñ–≥ –¢–µ–π—Å—Ç—ñ –°–∏–Ω–≥–ª", calories: 620, price: 192, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3442_Sdwch_Big_Tasty_Single.jpg" },
        { name: "–¢–µ–π—Å—Ç—ñ –î–∂—É–Ω—ñ–æ—Ä", calories: 400, price: 104, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3441_Sdwch_Big_Tasty_Junior.jpg" },
        { name: "–î–∞–±–ª –ë—ñ–≥ –¢–µ–π—Å—Ç—ñ", calories: 880, price: 271, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_3443_Sdwch_Big_Tasty_Double.jpg" },
        { name: "–î–∞–±–ª –†–æ—è–ª –ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 760, price: 240, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3415_DoubleRoyalCheeseburger_2.png" },
        { name: "–†–æ—è–ª –ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 530, price: 161, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3414_RoyalCheeseburger_2.png" },
        { name: "–ú–∞–∫–ß—ñ–∫–µ–Ω", calories: 448, price: 119, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3416_McChicken.png" },
        { name: "–§—ñ–ª–µ-–æ-–§—ñ—à", calories: 379, price: 117, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3412_File-o-Fish_2025.png" },
        { name: "–î–∞–±–ª –ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 475, price: 121, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3411_DoubleCheeseburger.png" },
        { name: "–ß—ñ–∑–±—É—Ä–≥–µ—Ä", calories: 298, price: 73, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3409_Cheeseburger.png" },
        { name: "–ì–∞–º–±—É—Ä–≥–µ—Ä", calories: 249, price: 63, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3408_Hamburger.png" },
        { name: "–ß—ñ–∫–µ–Ω –ú–∞–∫–ù–∞–≥–µ—Ç—Å 6—à—Ç", calories: 265, price: 101, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_2130_Nuggets_6.png" },
        { name: "–ß—ñ–∫–µ–Ω –ú–∞–∫–ù–∞–≥–µ—Ç—Å 9—à—Ç", calories: 398, price: 145, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_2131_Nuggets_9.png" },
        { name: "–ß—ñ–∫–µ–Ω –î–∂—É–Ω—ñ–æ—Ä", calories: 330, price: 73, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3426_CHICKEN_JUNIOR_BEST.png" },
        { name: "–ö—É—Ä—è—á—ñ —Å—Ç—Ä—ñ–ø—Å–∏ 3—à—Ç", calories: 200, price: 97, img: "https://d3tqkqn8yl74v5.cloudfront.net/TPO-chf_ua_3500_3strips.png" }
      ],
      kfc: [
        { name: "Zinger Burger", calories: 610, price: 6, img: "https://i.imgur.com/DrlUPPs.png" },
        { name: "Twister", calories: 480, price: 5, img: "https://i.imgur.com/z04v2Y2.png" },
        { name: "Fries Box", calories: 320, price: 3, img: "https://i.imgur.com/DN9jHZr.png" }
      ]
    };

    const sauces = [
      { name: "–ö–µ—Ç—á—É–ø" },
      { name: "–ì–∞—Ä–±—É–∑–æ–≤–∏–π —Å–æ—É—Å" },
      { name: "–°–∏—Ä–Ω–∏–π —Å–æ—É—Å" },
      { name: "–ß–∞—Å–Ω–∏–∫–æ–≤–∏–π —Å–æ—É—Å" },
      { name: "–ß–∏–ª—ñ —Å–æ—É—Å" }
    ];

    const drinks = [
      { name: "Coca-Cola" },
      { name: "Fanta" },
      { name: "Sprite" },
      { name: "–í–æ–¥–∞" },
      { name: "–ß–∞–π —Ö–æ–ª–æ–¥–Ω–∏–π" }
    ];

    // === –°–¢–ê–ù ===
    let selectedRestaurant = '';
    let excludedDishes = new Set();
    let currentPickedDish = null; // –¥–ª—è –º–æ–¥–∞–ª–∫–∏

    // –í–∏–±—ñ—Ä –¥–ª—è –±–∏–¥–ª–µ—Ä–∞ –º–µ–Ω—é
    let builderSelection = {
      dish: null,
      sauce: null,
      drink: null
    };

    // === –§–£–ù–ö–¶–Ü–á ===
    function selectRestaurant(restaurant) {
      selectedRestaurant = restaurant;
      document.getElementById("menuSection").style.display = "block";
      document.getElementById("menuBuilderSection").style.display = "none";
      document.getElementById("restaurantName").textContent =
        restaurant === "mcdonalds" ? "McDonald's" : "KFC";
      renderMenu();
    }

    function renderMenu() {
      const container = document.getElementById("dishList");
      container.innerHTML = '';
      menus[selectedRestaurant].forEach(dish => {
        const div = document.createElement("div");
        div.className = "item" + (excludedDishes.has(dish.name) ? " disabled" : "");
        div.innerHTML = `
          <div class="item-info">
            <img src="${dish.img}" alt="${dish.name}">
            <div class="item-details">
              <strong>${dish.name}</strong><br>
              ${dish.calories} –∫–∫–∞–ª ‚Äî ‚Ç¥${dish.price.toFixed(2)}
            </div>
          </div>
          <button class="btn-danger" onclick="toggleDish('${dish.name}')">
            ${excludedDishes.has(dish.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏"}
          </button>
        `;
        container.appendChild(div);
      });
    }

    function toggleDish(name) {
      if (excludedDishes.has(name)) {
        excludedDishes.delete(name);
      } else {
        excludedDishes.add(name);
      }
      renderMenu();
    }

    function filterAndPick() {
      const maxCalories = parseInt(document.getElementById("calorieFilter").value) || 9999;
      const maxPrice = parseFloat(document.getElementById("priceFilter").value) || 9999;
      const filtered = menus[selectedRestaurant].filter(d =>
        d.calories <= maxCalories &&
        d.price <= maxPrice &&
        !excludedDishes.has(d.name)
      );
      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö —Å—Ç—Ä–∞–≤ üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      if (selectedRestaurant === 'kfc') {
        alert(`üéâ –¢–≤–æ—è —Å—Ç—Ä–∞–≤–∞: ${pick.name}`);
      } else {
        showDishModal(pick);
      }
    }

    // --- –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –î–õ–Ø –í–ò–ë–†–ê–ù–û–á –°–¢–†–ê–í–ò ---
    function showDishModal(dish) {
      currentPickedDish = dish;
      document.getElementById("modalDishImg").src = dish.img;
      document.getElementById("modalDishName").textContent = dish.name;
      document.getElementById("modalExcludeBtn").textContent =
        excludedDishes.has(dish.name) ? "–í–∫–ª—é—á–∏—Ç–∏" : "–í–∏–∫–ª—é—á–∏—Ç–∏ –∑ —Ä–∞–Ω–¥–æ–º–∞";
      document.getElementById("dishModalOverlay").style.display = "flex";
    }

    function closeDishModal() {
      document.getElementById("dishModalOverlay").style.display = "none";
      currentPickedDish = null;
    }

    function pickAnotherDish() {
      closeDishModal();
      filterAndPick();
    }

    function excludeCurrentDish() {
      if (!currentPickedDish) return;
      const name = currentPickedDish.name;
      if (excludedDishes.has(name)) {
        excludedDishes.delete(name);
      } else {
        excludedDishes.add(name);
      }
      closeDishModal();
      renderMenu();
    }

    function chooseOnlyDish() {
      if (!currentPickedDish) return;
      const name = currentPickedDish.name;
      closeDishModal();
      alert(`–í–∏ –æ–±—Ä–∞–ª–∏ –±–ª—é–¥–æ: ${name}`);
    }

    function chooseMenu() {
      if (!currentPickedDish) return;
      closeDishModal();
      openMenuBuilder();
    }

    // --- –í–Ü–î–ö–†–ò–¢–ò –ë–Ü–õ–î–ï–† –ú–ï–ù–Æ ---
    function openMenuBuilder() {
      selectedRestaurant = 'mcdonalds';
      document.getElementById("menuSection").style.display = "none";
      document.getElementById("menuBuilderSection").style.display = "block";
      builderSelection = { dish: null, sauce: null, drink: null };
      document.getElementById("selectedDish").textContent = "–ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ–≥–æ –±–ª—é–¥–∞";
      document.getElementById("selectedSauce").textContent = "–ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Å–æ—É—Å—É";
      document.getElementById("selectedDrink").textContent = "–ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ–≥–æ –Ω–∞–ø–æ—é";
      document.getElementById("toSaucesBtn").disabled = true;
      document.getElementById("toDrinksBtn").disabled = true;
      document.getElementById("finishMenuBtn").disabled = true;
      switchTab('saucesTab', 'dishesTab');
    }

    // --- –í–ö–õ–ê–î–ö–ê 1: –í–ò–ë–Ü–† –ë–õ–Æ–î–ê –†–ê–ù–î–û–ú–û ---
    function randomizeBuilderDish() {
      const maxCalories = parseInt(document.getElementById("calorieFilter").value) || 9999;
      const maxPrice = parseFloat(document.getElementById("priceFilter").value) || 9999;
      const filtered = menus.mcdonalds.filter(d =>
        d.calories <= maxCalories &&
        d.price <= maxPrice &&
        !excludedDishes.has(d.name)
      );
      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å—Ç—Ä–∞–≤ üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      builderSelection.dish = pick;
      document.getElementById("selectedDish").innerHTML = `
        <div class="item-info">
          <img src="${pick.img}" alt="${pick.name}">
          <div class="item-details">
            <strong>${pick.name}</strong><br>
            ${pick.calories} –∫–∫–∞–ª ‚Äî ‚Ç¥${pick.price.toFixed(2)}
          </div>
        </div>
      `;
      document.getElementById("toSaucesBtn").disabled = false;
    }

    function toSauces() {
      if (!builderSelection.dish) return;
      switchTab('dishesTab', 'saucesTab');
    }

    // --- –í–ö–õ–ê–î–ö–ê 2: –í–ò–ë–Ü–† –°–û–£–°–£ –†–ê–ù–î–û–ú–û ---
    function randomizeBuilderSauce() {
      const filtered = sauces.filter(s => true);
      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å–æ—É—Å—ñ–≤ üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      builderSelection.sauce = pick;
      document.getElementById("selectedSauce").innerHTML = `
        <div class="item-info">
          <div class="item-details">
            <strong>${pick.name}</strong>
          </div>
        </div>
      `;
      document.getElementById("toDrinksBtn").disabled = false;
    }

    function backToDishes() {
      switchTab('saucesTab', 'dishesTab');
    }

    function toDrinks() {
      if (!builderSelection.sauce) return;
      switchTab('saucesTab', 'drinksTab');
    }

    // --- –í–ö–õ–ê–î–ö–ê 3: –í–ò–ë–Ü–† –ù–ê–ü–û–Æ –†–ê–ù–î–û–ú–û ---
    function randomizeBuilderDrink() {
      const filtered = drinks.filter(d => true);
      if (filtered.length === 0) {
        alert("–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –Ω–∞–ø–æ—ó–≤ üòï");
        return;
      }
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      builderSelection.drink = pick;
      document.getElementById("selectedDrink").innerHTML = `
        <div class="item-info">
          <div class="item-details">
            <strong>${pick.name}</strong>
          </div>
        </div>
      `;
      document.getElementById("finishMenuBtn").disabled = false;
    }

    function backToSauces() {
      switchTab('drinksTab', 'saucesTab');
    }

    function finishMenu() {
      const dishName = builderSelection.dish.name;
      const sauceName = builderSelection.sauce.name;
      const drinkName = builderSelection.drink.name;
      alert(`–í–∞—à–µ –º–µ–Ω—é:\n\n–°—Ç—Ä–∞–≤–∞: ${dishName}\n–°–æ—É—Å: ${sauceName}\n–ù–∞–ø—ñ–π: ${drinkName}`);
      document.getElementById("menuBuilderSection").style.display = "none";
      document.getElementById("menuSection").style.display = "block";
      renderMenu();
    }

    // --- –£–ù–Ü–í–ï–†–°–ê–õ–¨–ù–ê –§–£–ù–ö–¶–Ü–Ø –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ù–Ø –í–ö–õ–ê–î–û–ö ---
    function switchTab(hideId, showId) {
      document.getElementById(hideId).classList.remove('active');
      document.getElementById(showId).classList.add('active');
    }
  </script>
</body>
</html>
